<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>1.7.7. Simulating and defeating a Christmas Tree Packet Attack</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="1.7.7. Simulating and defeating a Christmas Tree Packet Attack"/>
  <meta name="product" content="F5 Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-01-28 09:36:45"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.7.7. Simulating and defeating a Christmas Tree Packet Attack &#8212; F5 Firewall Solutions  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Advanced Multi-Layer Firewall Protection" href="../../class2/class2.html" />
    <link rel="prev" title="1.7.6. About Postman – REST Client" href="step6.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class1.html">1. Class 1: AFM – The Data Center Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">2. Advanced Multi-Layer Firewall Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">3. Class - F5 BIG-IP DDoS and DNS DoS Protections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">4. Flowmon Integrated Out-of-path DDoS Solution</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">1.7.7. Simulating and defeating a Christmas Tree Packet Attack</a></li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Firewall Solutions</a>
              &gt; <a href="../class1.html">1. Class 1: AFM – The Data Center Firewall</a>
              &gt; <a href="intro.html">1.7. Lab 6 - iControl REST API</a>

          <span class="right">
             <a href="../../_sources/class1/lab6/step7.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-firewall">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="simulating-and-defeating-a-christmas-tree-packet-attack">
<h1>1.7.7. Simulating and defeating a Christmas Tree Packet Attack<a class="headerlink" href="#simulating-and-defeating-a-christmas-tree-packet-attack" title="Permalink to this headline">¶</a></h1>
<p>Now that we understand what REST is let’s use it to defeat Joanna one
last time. Joanna was feeling festive for her final attack. In this
example, we’ll set the BIG-IP to detect and mitigate Joanna’s attack
where all flags on a TCP packet are set. This is commonly referred to as
a Christmas tree packet and is intended to increase processing on
in-path network devices and end hosts to the target.</p>
<p>To interact with the REST API, we’ll be using POSTMan. We’ll then use
the hping utility to send 25,000 packets to our server, with random
source IPs to simulate a DDoS attack where multiple hosts are attacking
our server. We’ll set the SYN, ACK, FIN, RST, URG, PUSH, Xmas and Ymas
TCP flags.</p>
<ol class="arabic">
<li><p class="first">POSTMan is installed as an application and can be accessed from the desktop of the Jumpbox</p>
</li>
<li><p class="first">Once you launch POSTMan You’ll then want to import the API calls for the lab as well as the environment variables</p>
<ul class="simple">
<li>There is a notepad on the desktop labeled “Postman Links”</li>
<li>Within POSTman and click on the “Import” link near the top and then select “Import from Link”</li>
<li>Copy and paste the <strong>collection</strong> link from within the notepad and select “Import”</li>
<li>Copy and paste the <strong>environment</strong> link from within the notepad and select “Import”</li>
</ul>
<p><a class="reference internal" href="../../_images/image121.png"><img alt="image126" src="../../_images/image121.png" style="width: 6.5in; height: 4.08333in;" /></a></p>
</li>
<li><p class="first">Before proceeding verify the Agility 2018 environment is selected
from the drop down in the top right of POSTman</p>
<p><a class="reference internal" href="../../_images/image122.png"><img alt="image127" src="../../_images/image122.png" style="width: 3.86458in; height: 2.13542in;" /></a></p>
</li>
<li><p class="first">In the bigip01.dnstest.lab (<a class="reference external" href="https://192.168.1.100">https://192.168.1.100</a>) web UI, navigate
to Security &gt; DoS Protection &gt; Device Configuration &gt; Network
Security.</p>
</li>
<li><p class="first">Expand the <strong>Bad-Header-TCP</strong> category in the vectors list.</p>
</li>
<li><p class="first">Click on the <strong>Bad TCP Flags (All Flags Set)</strong> vector name and take note of the current settings</p>
</li>
<li><p class="first">Within POSTman open the collection “Agility 2018 Lab 5”</p>
<p><a class="reference internal" href="../../_images/image123.png"><img alt="image128" src="../../_images/image123.png" style="width: 2.50278in; height: 4.31042in;" /></a></p>
</li>
<li><p class="first">Run step 1 by clicking on the send button to the right</p>
<p><a class="reference internal" href="../../_images/image124.png"><img alt="image129" src="../../_images/image124.png" style="width: 6.49722in; height: 0.83056in;" /></a></p>
</li>
<li><p class="first">The output from the GET request can be reviewed, this is showing you
all the device-dos configuration options and settings. Search for
“bad-tcp-flags-all-set” by clicking ‘ctrl +f’. Note the values as
they are currently configured. We are now going to modify the Bad
TCP Flags (All Flags Set) attack vector. To do so run step 2 of the
collection by highlighting the collection and click “Send”.</p>
</li>
<li><p class="first">You can now execute step 3 in the collection and verify the changes,
you can also verify the changes in the BIG-IP web UI.</p>
<p><a class="reference internal" href="../../_images/image78.png"><img alt="image130" src="../../_images/image78.png" style="width: 2.43392in; height: 2.49669in;" /></a></p>
</li>
<li><p class="first">Open the BIG-IP SSH session and scroll the ltm log in real time with
the following command: tail -f /var/log/ltm</p>
</li>
<li><div class="first line-block">
<div class="line">On the attack host, launch the attack by issuing the following command on the BASH prompt:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">hping3</span> <span class="pre">10.20.0.10</span> <span class="pre">--flood</span> <span class="pre">--rand-source</span> <span class="pre">--destport</span> <span class="pre">80</span> <span class="pre">-c</span> <span class="pre">25000</span> <span class="pre">--syn</span> <span class="pre">--ack</span> <span class="pre">--fin</span> <span class="pre">--rst</span> <span class="pre">--push</span> <span class="pre">--urg</span> <span class="pre">--xmas</span> <span class="pre">--ymas</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">You’ll see the BIG-IP ltm log show that the attack has been detected:</div>
<div class="line"><a class="reference internal" href="../../_images/image79.png"><img alt="image131" src="../../_images/image79.png" style="width: 4.48611in; height: 0.38889in;" /></a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">After approximately 60 seconds, press <strong>CTRL+C</strong> to stop the attack.</div>
<div class="line"><a class="reference internal" href="../../_images/image80.png"><img alt="image132" src="../../_images/image80.png" style="width: 4.43056in; height: 0.97222in;" /></a></div>
</div>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>DoS Protection</strong>&gt; <strong>DoS Overview (you
may need to refresh or set the auto refresh to 10 seconds).</strong> You’ll
notice from here you can see all the details of the active attacks.
You can also modify an attack vector right from this screen by
clicking on the attack vector and modifying the fly out.</p>
<p><a class="reference internal" href="../../_images/image81.png"><img alt="image133" src="../../_images/image81.png" style="width: 6.49097in; height: 1.10208in;" /></a></p>
</li>
<li><div class="first line-block">
<div class="line">Return to the BIG-IP web UI. Navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt; <strong>DoS</strong> &gt; <strong>Network</strong> &gt; <strong>Events</strong>. Observe the log entries showing the details surrounding the attack detection and mitigation.</div>
<div class="line"><a class="reference internal" href="../../_images/image82.png"><img alt="image134" src="../../_images/image82.png" style="width: 5in; height: 1.70833in;" /></a></div>
</div>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Reporting</strong> &gt; <strong>DoS</strong> &gt; <strong>Analysis</strong>.
Single-click on the attack ID in the filter list to the right of the
charts and observe the various statistics around the attack.</p>
</li>
<li><p class="first">The same attacks can also be seen in BIG-IQ as demonstrated in the previous lab.</p>
</li>
</ol>
<p><strong>Congratulations, you have successfully defeated Joanna’s festive attack using only the REST API to configure the device!</strong></p>
<p>Since it’s the end of the week and Joanna is using the same IP address continually, lets block
her IP address and her subnet using BIG-IQ. We’ll use the REST API to
accomplish this as well, as BIG-IQ also has an available REST API.</p>
<ol class="arabic">
<li><p class="first">Using POSTman run step 4, this will create an address-list within
BIG-IQ, the advantage to address-lists is they allow you to group
similar objects into a group. In this instance we’re going to create
an address-list named API_Naughty_Address_List with a host and a
network. Once you run the command you’ll receive output below. You
will need to copy the value returned in the ‘ID” field as shown
below:</p>
<p><a class="reference internal" href="../../_images/image125.png"><img alt="image135" src="../../_images/image125.png" style="width: 6.49097in; height: 1.82708in;" /></a></p>
</li>
<li><p class="first">Take the copied text and paste it into the environment variable for
AFM_Adddress_ID. The variables are accessed by clicking on the “eye”
icon next to where you selected the Agility 2018 Environment:</p>
<p><a class="reference internal" href="../../_images/image126.png"><img alt="image136" src="../../_images/image126.png" style="width: 3.81806in; height: 3.66389in;" /></a></p>
</li>
<li><p class="first">Click edit and enter the value returned in step 1, when completed
click update</p>
<p><a class="reference internal" href="../../_images/image127.png"><img alt="image137" src="../../_images/image127.png" style="width: 5.99097in; height: 6.22708in;" /></a></p>
</li>
<li><p class="first">We will now create a rule list name first, to accomplish this send
the call found in step 5. You will need to also capture the “ID” in
this step as well. This value will be updated in the AFM_Rule_ID
field</p>
<p><a class="reference internal" href="../../_images/image128.png"><img alt="image138" src="../../_images/image128.png" style="width: 6.49097in; height: 1.31806in;" /></a></p>
</li>
<li><p class="first">Take the copied text and paste it into the environment variable for
AFM_Rule_ID</p>
<p><a class="reference internal" href="../../_images/image129.png"><img alt="image139" src="../../_images/image129.png" style="width: 5.98194in; height: 6.18194in;" /></a></p>
</li>
<li><p class="first">At this stage we have created an address-list with objects and saved
the ID, we have also created a rule name and saved the ID. The next
step is to add an actual rule to the newly created rule named
“Naughty_Rule_List”. Before you send the call-in step 6, take a
moment to examine the body of the request. You’ll notice in the URI
we’re referencing the variable of AFM_Rule_ID and in the body of the
JSON request we’re linking the AFM_Address_ID to the rule. Once sent
you’ll receive confirmation similar to the below output.</p>
<p><a class="reference internal" href="../../_images/image130.png"><img alt="image140" src="../../_images/image130.png" style="width: 6.5in; height: 4.83333in;" /></a></p>
</li>
<li><p class="first">Since this is an existing environment, we’re going to first need to
obtain the policy ID before we can assign the value to this variable.
To obtain the policy ID of the existing policy we created in lab 1
and imported in the prior lab, run step 7.</p>
<p><a class="reference internal" href="../../_images/image131.png"><img alt="image141" src="../../_images/image131.png" style="width: 6.49097in; height: 3.15486in;" /></a></p>
</li>
<li><p class="first">You will notice there are two policies, Global and rd_0_policy, we’ll
need to copy the ID for the rd_0_policy which is located directly
under its name and paste it into the variable for AFM_Policy_ID.</p>
<p><a class="reference internal" href="../../_images/image132.png"><img alt="image142" src="../../_images/image132.png" style="width: 6in; height: 3.33333in;" /></a></p>
</li>
<li><p class="first">Finally run step 8 to add the new rule list to the existing policy,
when completed you’ll receive output similar as seen below.</p>
<p><a class="reference internal" href="../../_images/image133.png"><img alt="image143" src="../../_images/image133.png" style="width: 6.49097in; height: 1.87292in;" /></a></p>
</li>
<li><p class="first">Before we deploy the policy. Log into the BIG-IQ web UI
(<a class="reference external" href="https://192.168.1.50">https://192.168.1.50</a>) and navigate to Configuration Security
Network Security Firewall Policies. Click on the link for the
rd_0_policy, expand all the rules to verify your new API created
rule list is first in the list and all objects are created as
expected.</p>
<p><a class="reference internal" href="../../_images/image134.png"><img alt="image144" src="../../_images/image134.png" style="width: 6.5in; height: 1.69097in;" /></a></p>
</li>
<li><p class="first">The final step is to deploy the policy to the BIG-IP. Before we can
do this, we have one last variable we’ll need to acquire, the
machine ID of bigip02.dnslab.test. To obtain the machine ID run the
call in step 9, once the call is run, you will look for the
machineId key and copy the value to the environment variable
bigip02-machined as shown below and click update.</p>
<p><a class="reference internal" href="../../_images/image135.png"><img alt="image145" src="../../_images/image135.png" style="width: 6.5in; height: 1.27292in;" /></a></p>
<p><a class="reference internal" href="../../_images/image136.png"><img alt="image146" src="../../_images/image136.png" style="width: 6in; height: 3.33333in;" /></a></p>
</li>
<li><p class="first">Finally, you will run step 10, this will initiate a deployment on
BIG-IQ to deploy the changes to BIG-IP. Within BIG-IQ navigate to
Deployment Evaluate &amp; Deploy Network Security. At the bottom in the
deployments section you’ll notice an API Policy Deploy task. Feel
free to click on the task to investigate the changes. Once the
policy has deployed, log into the web UI of bigip02.dnstest.lab and
navigate to Security network Firewall Active Rules. Change the
context to Route Domain and select 0. Expand all of the rules to
verify the rules have been deployed as expected. Your final screen
should look something like the screen capture below.</p>
<p><a class="reference internal" href="../../_images/image137.png"><img alt="image147" src="../../_images/image137.png" style="width: 6.5in; height: 3.23611in;" /></a></p>
</li>
</ol>
<p>Lastly, in your web browser, verify you can no longer access the web
pages <a class="reference external" href="http://10.30.0.50">http://10.30.0.50</a> and <a class="reference external" href="http://10.40.0.50">http://10.40.0.50</a> as well as no longer being
able to SSH to any of the devices.</p>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="step6.html" title="1.7.6. About Postman – REST Client" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="../../class2/class2.html" title="2. Advanced Multi-Layer Firewall Protection" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>