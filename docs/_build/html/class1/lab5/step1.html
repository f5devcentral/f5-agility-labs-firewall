<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>1.6.1. Network Security (AFM) Management Workflows</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="1.6.1. Network Security (AFM) Management Workflows"/>
  <meta name="product" content="F5 Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-01-28 09:36:45"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.6.1. Network Security (AFM) Management Workflows &#8212; F5 Firewall Solutions  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.6.2. Workflow 2: Configure Network Security and DoS Event Logging" href="step2.html" />
    <link rel="prev" title="1.6. Lab 5 - Network Security (AFM) Management Workflows" href="intro.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class1.html">1. Class 1: AFM – The Data Center Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">2. Advanced Multi-Layer Firewall Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">3. Class - F5 BIG-IP DDoS and DNS DoS Protections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">4. Flowmon Integrated Out-of-path DDoS Solution</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">1.6.1. Network Security (AFM) Management Workflows</a><ul>
<li><a class="reference internal" href="#workflow-1-managing-afm-from-big-iq">1.6.1.1. Workflow 1: Managing AFM from BIG-IQ</a><ul>
<li><a class="reference internal" href="#task-1-packet-tracer">1.6.1.1.1. Task 1 – Packet Tracer</a></li>
<li><a class="reference internal" href="#task-2-modify-rule-lists">1.6.1.1.2. Task 2 – Modify Rule Lists</a></li>
<li><a class="reference internal" href="#task-3-deploy-the-firewall-policy-and-related-configuration-objects">1.6.1.1.3. Task 3 – Deploy the Firewall Policy and related configuration objects</a></li>
<li><a class="reference internal" href="#task-4-packet-tracer-continued">1.6.1.1.4. Task 4 – Packet Tracer (continued)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Firewall Solutions</a>
              &gt; <a href="../class1.html">1. Class 1: AFM – The Data Center Firewall</a>
              &gt; <a href="intro.html">1.6. Lab 5 - Network Security (AFM) Management Workflows</a>

          <span class="right">
             <a href="../../_sources/class1/lab5/step1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-firewall">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="network-security-afm-management-workflows">
<h1>1.6.1. Network Security (AFM) Management Workflows<a class="headerlink" href="#network-security-afm-management-workflows" title="Permalink to this headline">¶</a></h1>
<div class="section" id="workflow-1-managing-afm-from-big-iq">
<h2>1.6.1.1. Workflow 1: Managing AFM from BIG-IQ<a class="headerlink" href="#workflow-1-managing-afm-from-big-iq" title="Permalink to this headline">¶</a></h2>
<p>Day 4, it turns out no one thought about managing the new web and
application servers, as such SSH is blocked to both devices. Let’s first
validate this by using the packet tester tool within BIG-IQ, note this
is the same tool within BIG-IP with one major exception. Within BIG-IQ
you can trace a packet through <strong>more than one firewall</strong>. This is very
useful if you have multiple AFM devices in a packets path, now you can
test the flow end to end from one central location.</p>
<div class="section" id="task-1-packet-tracer">
<h3>1.6.1.1.1. Task 1 – Packet Tracer<a class="headerlink" href="#task-1-packet-tracer" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Monitoring &gt; Reports &gt; Security &gt; Network Security &gt; Packet Traces</strong></p>
<p><a class="reference internal" href="../../_images/image105.png"><img alt="image109" src="../../_images/image105.png" style="width: 4.54514in; height: 4.10903in;" /></a></p>
</li>
<li><p class="first">Click on the “Create” button from the top menu.</p>
</li>
<li><p class="first">Complete the following information</p>
<ul class="simple">
<li>Name – ssh_trace</li>
<li>Protocol – tcp</li>
<li>TCP Flags – Syn</li>
<li>Source IP Address – 10.20.0.200</li>
<li>Source Port – 9999</li>
<li>Destination IP Address – 10.30.0.50</li>
<li>Destination Port – 22</li>
<li>Use Staged Policy – No</li>
<li>Trigger Log – No</li>
</ul>
</li>
<li><p class="first">Under the Devices section click “Add” (notice you’ll see all the devices
with AFM provision listed), for our lab however; just add <strong>bigip2.dnstest.lab</strong></p>
<p><a class="reference internal" href="../../_images/image106.png"><img alt="image110" src="../../_images/image106.png" style="width: 6.49097in; height: 3.76389in;" /></a></p>
</li>
<li><p class="first">Select the “/Common/OUTSIDE” Vlan as the Source VLAN from the dropdown.</p>
<p>When completed your screen should look like the screen shot below:</p>
<p><a class="reference internal" href="../../_images/image107.png"><img alt="image111" src="../../_images/image107.png" style="width: 5.91089in; height: 3.67852in;" /></a></p>
</li>
<li><p class="first">Click “Run Trace”</p>
<p>You can see from the trace results; the traffic is indeed being denied</p>
<p><a class="reference internal" href="../../_images/image108.png"><img alt="image112" src="../../_images/image108.png" style="width: 6.5in; height: 3.18194in;" /></a></p>
</li>
</ol>
<p>Another nice feature of Packet Trace within BIG-IQ is the ability to
clone a trace, when you complete the next two tasks, we’ll return to the
packet tracer tool to re-run the results using the clone option.
Additionally, the traces are saved and can be reviewed later, this can
be very helpful in long troubleshooting situations where application
teams are asking for results after changes are made to policies.</p>
<p>Follow the steps below to allow SSH access to both devices using BIG-IQ
as a central management tool.</p>
</div>
<div class="section" id="task-2-modify-rule-lists">
<h3>1.6.1.1.2. Task 2 – Modify Rule Lists<a class="headerlink" href="#task-2-modify-rule-lists" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Navigate to the <strong>Configuration &gt; Security &gt; Network Security &gt; Rule Lists</strong></p>
</li>
<li><p class="first">Notice the previously created rule lists have been imported into BIG-IQ</p>
</li>
<li><p class="first">Click on the “<strong>application_rule_list</strong>”</p>
</li>
<li><p class="first">Click <strong>Create Rule</strong> button.</p>
</li>
<li><p class="first">Click on the pencil (edit rule) of the newly created rule listed with <strong>Id</strong> of <strong>2.</strong></p>
</li>
<li><p class="first">Create a new rule with the below information. Be prepared to scroll to find all the options</p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">allow_ssh</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Source Address</strong></td>
<td><strong>10.20.0.200</strong></td>
</tr>
<tr class="row-odd"><td><strong>Source Port</strong></td>
<td><strong>any</strong></td>
</tr>
<tr class="row-even"><td><strong>Source VLAN</strong></td>
<td><strong>any</strong></td>
</tr>
<tr class="row-odd"><td><strong>Destination Address</strong></td>
<td><strong>10.30.0.50</strong></td>
</tr>
<tr class="row-even"><td><strong>Destination Port</strong></td>
<td><strong>22</strong></td>
</tr>
<tr class="row-odd"><td><strong>Action</strong></td>
<td><strong>Accept-Decisively</strong></td>
</tr>
<tr class="row-even"><td><strong>Protocol</strong></td>
<td><strong>TCP</strong></td>
</tr>
<tr class="row-odd"><td><strong>State</strong></td>
<td><strong>enabled</strong></td>
</tr>
<tr class="row-even"><td><strong>Log</strong></td>
<td><strong>True (checked)</strong></td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Click <strong>Save &amp; Close</strong> when finished.</p>
</li>
<li><p class="first">Repeat the same procedure for the web_rule_list, be sure to change the destination to 10.30.0.50, all other setting remains the same.</p>
</li>
</ol>
</div>
<div class="section" id="task-3-deploy-the-firewall-policy-and-related-configuration-objects">
<h3>1.6.1.1.3. Task 3 – Deploy the Firewall Policy and related configuration objects<a class="headerlink" href="#task-3-deploy-the-firewall-policy-and-related-configuration-objects" title="Permalink to this headline">¶</a></h3>
<p>Now that the desired firewall configuration has been created on the
BIG-IQ, you need to deploy it to the BIG-IP. In this task, you create
the deployment, verify it, and deploy it.</p>
<ol class="arabic">
<li><p class="first">From the top navigation bar, click on <strong>Deployment</strong> (tab).</p>
</li>
<li><p class="first">Click on the <strong>EVALUATE &amp; DEPLOY</strong> section on the left to expand it.</p>
</li>
<li><p class="first">Click on <strong>Network Security</strong> in the expansion.</p>
<p><a class="reference internal" href="../../_images/image109.png"><img alt="image113" src="../../_images/image109.png" style="width: 4.65486in; height: 3.92708in;" /></a></p>
</li>
<li><p class="first">Click on the top <strong>Create</strong> button under the <strong>Evaluations</strong> section.</p>
</li>
<li><p class="first">Give your evaluation a name (ex: <strong>deploy_afm1</strong>).</p>
</li>
<li><p class="first">Evaluation <strong>Source</strong> should be <strong>Current Changes</strong> (default).</p>
</li>
<li><p class="first">Source Scope should be <strong>All Changes</strong> (default)</p>
</li>
<li><p class="first">Remove Unused Objects should be <strong>Remove Unused Objects</strong> (default)</p>
</li>
<li><p class="first">Target Device(s) should be <strong>Device</strong>.</p>
</li>
<li><p class="first">Select <strong>bigip2.dnstest.lab</strong> from the list of Available devices and move it to Selected area.</p>
<p><a class="reference internal" href="../../_images/image110.png"><img alt="image114" src="../../_images/image110.png" style="width: 6.5in; height: 2.40903in;" /></a></p>
</li>
<li><p class="first">Click the <strong>Create</strong> button at the bottom right of the page.</p>
<p>You should be redirected to the main <strong>Evaluate and Deploy</strong> page.</p>
<p>This will start the evaluation process in which BIG-IQ compares its
working configuration to the configuration active on each BIG-IP.
This can take a few moments to complete.</p>
<p>The <strong>Status</strong> section should be dynamically updating… (What states do you see?)</p>
<p>Once the status shows <strong>Evaluation Complete</strong> you can view the evaluation results.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before selecting to deploy, feel free to select the differences indicated to see the proposed deployment changes. This is your check before making changes on a BIG-IP.</p>
</div>
</li>
<li><p class="first">Click the number listed under <strong>Differences – Firewall</strong>.</p>
</li>
<li><p class="first">Scroll through the list of changes to be deployed.</p>
</li>
<li><p class="first">Click on a few to review in more detail.</p>
<p>What differences do you see from the <strong>Deployed on BIG-IP</strong> section and
on <strong>BIG-IQ</strong>?</p>
<p>Do you see the new rules you created in BIG-IQ? Ya should…</p>
</li>
<li><p class="first">Click <strong>Cancel</strong>.</p>
<p>Deploy your changes by checking the box next to your evaluation <strong>deploy_afm1</strong>.</p>
</li>
<li><p class="first">With the box checked, click the <strong>Deploy</strong> button.</p>
<p>Your evaluation should move to the <strong>Deployments</strong> section.</p>
<p>After deploying, the status should change to <strong>Deployment Complete</strong>.</p>
<ul class="simple">
<li>This will take a moment to complete. Once completed, log in to the
BIG-IP and verify that the changes have been deployed to the AFM
configuration.</li>
</ul>
</li>
</ol>
<p>Congratulations, you just deployed your first AFM policy via BIG-IQ!</p>
<p>Review the configuration deployed to the BIG-IP units.</p>
<p>On <strong>bigip2.dnstest.lab</strong>: (<a class="reference external" href="https://192.168.1.150">https://192.168.1.150</a>)</p>
<ol class="arabic">
<li><p class="first">Navigate to Security &gt; Network Firewall &gt; Policies.</p>
</li>
<li><p class="first">Click on rd_0_policy and expand the rule lists</p>
<p>Are the two rules you created in BIG-IQ listed for this newly deployed firewall policy?</p>
<p><a class="reference internal" href="../../_images/image111.png"><img alt="image115" src="../../_images/image111.png" style="width: 6.48194in; height: 1.71806in;" /></a></p>
<p><a class="reference internal" href="../../_images/image112.png"><img alt="image116" src="../../_images/image112.png" style="width: 4.34028in; height: 2.38194in;" /></a></p>
</li>
</ol>
<p>Test Access:</p>
<ol class="arabic simple">
<li>Open a new Web browser and access <a class="reference external" href="http://10.30.0.50">http://10.30.0.50</a></li>
<li>Open Putty and access 10.30.0.50</li>
</ol>
</div>
<div class="section" id="task-4-packet-tracer-continued">
<h3>1.6.1.1.4. Task 4 – Packet Tracer (continued)<a class="headerlink" href="#task-4-packet-tracer-continued" title="Permalink to this headline">¶</a></h3>
<p>#. Navigate to the Monitoring tab Reports Security Network Security Packet
Tracers</p>
<ol class="arabic">
<li><p class="first">Highlight the previous trace (ssh_trace) and click on the “Clone” button</p>
<p><a class="reference internal" href="../../_images/image113.png"><img alt="image117" src="../../_images/image113.png" style="width: 6.49097in; height: 0.85486in;" /></a></p>
<p>You’ll notice all the previously entered values are pre-populated, you
now can make any changes if necessary (maybe the application team
realized the source port of the flow is not random).</p>
</li>
<li><p class="first">Click “Run Trace”</p>
<p><a class="reference internal" href="../../_images/image114.png"><img alt="image118" src="../../_images/image114.png" style="width: 6.49097in; height: 3.13611in;" /></a></p>
</li>
</ol>
<p>SUCCESS!!</p>
<p>The history within the tool makes Root Cause Analysis (RCA) reports very
easy, this allows the security team to show a denied flow and subsequent
permitted flow.</p>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="intro.html" title="1.6. Lab 5 - Network Security (AFM) Management Workflows" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="step2.html" title="1.6.2. Workflow 2: Configure Network Security and DoS Event Logging" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>